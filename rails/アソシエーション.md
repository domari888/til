# アソシエーションについて
- モデル間での１対多や多対多の関連付けのこと。  
メッセージ投稿アプリなどで、ログインユーザーなどを利用する際に、関連付けする事で「どのユーザーのどの投稿」かを判断できるようになる。  
  
- 1対多の関係  
1ユーザーに対して複数の投稿。  
User は 1 , Post は 多 となる。  

- 多対多の関係

## 1対多の関連付け
- User モデルに `has_many :posts, dependent: :destroy`を追記して関連付け
  - User モデルは `devise` などで作成済とする
  - １ユーザーに対して多投稿となる為 `posts`とする（複数形）
  - `dependent: :destroy`をつけることでユーザーを削除した際に投稿も削除される
- Post モデルに`belongs_to :user`を追記して関連付け(自動生成できる)
  -１投稿に対して１ユーザーとなる為`user`とする（単数系）  
  
### 外部キーを持つモデルの作成
- `references`とすることで外部キーであることを明示し、自動的にモデルに`belongs_to :user`を生成
```ruby
rails g model モデル名 カラム名:カラム型　外部キー:references
```  

- (例)user_idを持つPostモデル
```ruby
rails g model Post content:string user:references
```  

#### 備考
- `null`を入れないように、生成されたマイグレーションファイルに追加
```ruby
# null: false を追加
# (例) Post テーブル
t.string :content, null: false
```  

- 入力必須 とするため，モデルにバリデーションを追加
```ruby
# (例) Post モデル
validates :content, presence: true
```  

### 関連付け
- 関連付けすることで描けるようになる書き方
  - 投稿を post1 とする
  - ユーザーを user1 とする
```ruby
# post１を投稿したユーザーのデータ
post1.user
# post１を投稿したユーザーのメールアドレスデータ
post1.user.email
  
# ユーザー１の全ての投稿
user1.posts
# ユーザー１の最初の投稿
user1.posts[0].content
# ユーザー１の投稿を作成
user1.posts.create!
```  
  
### 編集、削除機能
- 投稿ユーザーとログインユーザーが一致しているか判断してからアクションが動くようにする
```ruby
# アクションより前に書く
before_action :set_post, only: %i[edit update destroy]
```
- ログインユーザーの投稿の中から選択した投稿のIDと一致するのを見つける
```ruby
# private メソッドに書く
def set_post
  @post = current_user.posts.find(params[:id])
end
```  
